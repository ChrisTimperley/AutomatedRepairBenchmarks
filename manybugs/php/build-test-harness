#!/usr/bin/python
import fnmatch
import os

# Build a list of all the test cases for the program
tests = set()
for (root, dirs, files) in os.walk('/experiment/src'):
    root = os.path.relpath(root, '/experiment/src')
    for f in fnmatch.filter(files, '*.phpt'):
        test = os.path.join(root, f)
        tests.add(test)

# Find a list of the failing tests
with open("/experiment/bug-info/scenario-data.txt", "r") as f:
    lines = [l.strip() for l in f]

cut_from = \
    (i for (i,l) in enumerate(lines) if l.startswith("failing tests:")).next()
cut_to = \
    (i for (i,l) in enumerate(lines) if l.startswith("minutes between bug rev and fix rev:")).next()
failing = set(lines[cut_from+1:cut_to-1])

# Deduce the set of passing tests
passing = tests - failing

# write failing tests to disk
with open("failing.tests.txt", "w") as f:
    f.writelines(failing)

# write passing tests to disk
with open("passing.tests.txt", "w") as f:
    f.writelines(passing)
